<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Debugging with gdb &mdash; ecto</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/breathe.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="ecto" href="../../../index.html" />
    <link rel="up" title="Usage" href="../index.html" />
    <link rel="next" title="Valgrind" href="valgrind.html" />
    <link rel="prev" title="Using IPython" href="ipython.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="valgrind.html" title="Valgrind"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ipython.html" title="Using IPython"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../index.html">ecto</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Usage</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/ecto210.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Debugging with gdb</a><ul>
<li><a class="reference internal" href="#running-an-ecto-script-under-gdb">Running an ecto script under gdb</a></li>
<li><a class="reference internal" href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ipython.html"
                        title="previous chapter">Using IPython</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="valgrind.html"
                        title="next chapter">Valgrind</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../_sources/ecto/usage/external/debugging.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="debugging-with-gdb">
<span id="debugging"></span><h1>Debugging with gdb<a class="headerlink" href="#debugging-with-gdb" title="Permalink to this headline">¶</a></h1>
<div class="section" id="running-an-ecto-script-under-gdb">
<span id="index-0"></span><h2>Running an ecto script under gdb<a class="headerlink" href="#running-an-ecto-script-under-gdb" title="Permalink to this headline">¶</a></h2>
<p>You&#8217;ll notice that as such, you can&#8217;t run a script under gdb:</p>
<div class="highlight-ectosh"><div class="highlight"><pre><span class="mf">%</span><span class="gd"> gdb ../src/ecto/test/scripts/test_random.py</span>
GNU gdb (Ubuntu/Linaro 7.2-1ubuntu11) 7.2
[ chattiness ]
&quot;/ssd/ecto_kitchen/src/ecto/test/scripts/test_random.py&quot;: not in executable format: File format not recognized
</pre></div>
</div>
<p>The trick is to run <tt class="docutils literal"><span class="pre">gdb</span></tt> on the python binary, not the script, and
pass the script as an argument.  <tt class="docutils literal"><span class="pre">gdb</span></tt> will detect when the script
imports modules of ecto cells and debug those too.  Use gdb&#8217;s
<tt class="docutils literal"><span class="pre">--args</span></tt> argument, for instance:</p>
<div class="highlight-ectosh"><div class="highlight"><pre><span class="mf">%</span><span class="gd"> gdb --args /usr/bin/python ../ecto/test/scripts/test_random.py</span>
GNU gdb (Ubuntu/Linaro 7.2-1ubuntu11) 7.2
Copyright (C) 2010 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;
and &quot;show warranty&quot; for details.
This GDB was configured as &quot;x86_64-linux-gnu&quot;.
For bug reporting instructions, please see:
&lt;http://www.gnu.org/software/gdb/bugs/&gt;...
Reading symbols from /usr/bin/python...(no debugging symbols found)...done.
<span class="mf">(gdb)</span>
</pre></div>
</div>
<p>At this point, since you haven&#8217;t run the script yet, gdb won&#8217;t know
about the cells inside any of the compiled modules that the script
imports.  Run the script once to trigger the shared library loads:</p>
<div class="highlight-ectosh"><div class="highlight"><pre><span class="mf">(gdb)</span><span class="gd"> r</span>
Starting program: /usr/bin/python ../ecto/test/scripts/test_random.py
[Thread debugging using libthread_db enabled]
***** 0.294665 ***** 0x1031980
***** 0.181778 ***** 0x1031980
[etc]
***** 0.850141 ***** 0x1031980
[Inferior 1 (process 24050) exited normally]
<span class="mf">(gdb)</span>
</pre></div>
</div>
<p>Now you can set breakpoints inside cells, don&#8217;t forget any namespace
that the cell lives in:</p>
<div class="highlight-ectosh"><div class="highlight"><pre><span class="mf">(gdb)</span><span class="gd"> break ecto_test::Uniform01::process(ecto::tendrils const&amp;, ecto::tendrils&amp;)</span>
Breakpoint 1 at 0x7fffec5d6169: file /home/ecto_kitchen/ecto/test/modules/Uniform01.cpp, line 88.
<span class="mf">(gdb)</span><span class="gd"> r</span>
Starting program: /usr/bin/python ../ecto/test/scripts/test_random.py
[Thread debugging using libthread_db enabled]

Breakpoint 1, ecto_test::Uniform01::process (this=0x1031950, inputs=..., outputs=...)
    at /home/ecto_kitchen/ecto/test/modules/Uniform01.cpp:88
88          for (unsigned j=0; j&lt;ncalls; ++j)
<span class="mf">(gdb)</span>
</pre></div>
</div>
<p>As usual <tt class="docutils literal"><span class="pre">where</span></tt> will get you your backtrace.  As you can see below,
as you go up the stack you pass from the cell&#8217;s code (the <tt class="docutils literal"><span class="pre">process</span></tt>
method):</p>
<div class="highlight-ectosh"><div class="highlight"><pre><span class="mf">(gdb)</span><span class="gd"> where</span>
#0  ecto_test::Uniform01::process (this=0x1031950, inputs=..., outputs=...)
  at /home/ecto_kitchen/ecto/test/modules/Uniform01.cpp:88
</pre></div>
</div>
<p>up through ecto&#8217;s compiled C++ code:</p>
<div class="highlight-ectosh"><div class="highlight"><pre>#1  0x00007fffec5dd322 in ecto::cell_&lt;ecto_test::Uniform01&gt;::process (this=0x971f00, inputs=..., outputs=...)
    at /home/ecto_kitchen/ecto/include/ecto/cell.hpp:366
#2  0x00007fffec5dc270 in ecto::cell_&lt;ecto_test::Uniform01&gt;::dispatch_process (this=0x971f00, inputs=..., outputs=...)
    at /home/ecto_kitchen/ecto/include/ecto/cell.hpp:378
#3  0x00007ffff55b0beb in ecto::cell::process (this=0x971f00) at /home/ecto_kitchen/ecto/src/lib/cell.cpp:137
#4  0x00007ffff55e754a in ecto::schedulers::invoke_process (graph=..., vd=0)
    at /home/ecto_kitchen/ecto/src/lib/schedulers/invoke.cpp:39
#5  0x00007ffff55e9402 in ecto::schedulers::singlethreaded::invoke_process (this=0x1031890, vd=0)
    at /home/ecto_kitchen/ecto/src/lib/schedulers/singlethreaded.cpp:56
#6  0x00007ffff55e981b in ecto::schedulers::singlethreaded::execute_impl (this=0x1031890, niter=100)
    at /home/ecto_kitchen/ecto/src/lib/schedulers/singlethreaded.cpp:121
#7  0x00007ffff55e9750 in ecto::schedulers::singlethreaded::execute (this=0x1031890, niter=100)
    at /home/ecto_kitchen/ecto/src/lib/schedulers/singlethreaded.cpp:102
</pre></div>
</div>
<p>through ecto&#8217;s python binding layer:</p>
<div class="highlight-ectosh"><div class="highlight"><pre>#8  0x00007ffff66acfdc in ecto::py::execute1&lt;ecto::schedulers::singlethreaded&gt; (s=..., arg1=100)
    at /home/ecto_kitchen/ecto/src/pybindings/schedulers.cpp:11
#9  0x00007ffff66b84b6 in boost::python::detail::invoke&lt;boost::python::to_python_value&lt;int const&amp;&gt;, int (*)(ecto::schedulers::singlethreaded&amp;, unsigned int), boost::python::arg_from_python&lt;ecto::schedulers::singlethreaded&amp;&gt;, boost::python::arg_from_python&lt;unsigned int&gt; &gt; (rc=..., f=@0x963cd8, ac0=..., ac1=...)
    at /usr/include/boost/python/detail/invoke.hpp:75
#10 0x00007ffff66b69c8 in boost::python::detail::caller_arity&lt;2u&gt;::impl&lt;int (*)(ecto::schedulers::singlethreaded&amp;, unsigned int), boost::python::default_call_policies, boost::mpl::vector3&lt;int, ecto::schedulers::singlethreaded&amp;, unsigned int&gt; &gt;::operator() (this=0x963cd8, args_=0xf5d128) at /usr/include/boost/python/detail/caller.hpp:223
#11 0x00007ffff66b53e3 in boost::python::objects::caller_py_function_impl&lt;boost::python::detail::caller&lt;int (*)(ecto::schedulers::singlethreaded&amp;, unsigned int), boost::python::default_call_policies, boost::mpl::vector3&lt;int, ecto::schedulers::singlethreaded&amp;, unsigned int&gt; &gt; &gt;::operator() (this=0x963cd0, args=0xf5d128, kw=0x1028320)
    at /usr/include/boost/python/object/py_function.hpp:38
#12 0x00007ffff6178c2e in boost::python::objects::function::call(_object*, _object*) const ()
   from /usr/lib/libboost_python-py26.so.1.40.0
#13 0x00007ffff6178ed8 in ?? () from /usr/lib/libboost_python-py26.so.1.40.0
#14 0x00007ffff618054b in boost::python::handle_exception_impl(boost::function0&lt;void&gt;) ()
   from /usr/lib/libboost_python-py26.so.1.40.0
#15 0x00007ffff61757d8 in ?? () from /usr/lib/libboost_python-py26.so.1.40.0
</pre></div>
</div>
<p>up to the python interpreter itself:</p>
<div class="highlight-ectosh"><div class="highlight"><pre>#16 0x000000000041f0c7 in PyObject_Call ()
#17 0x00000000004a7378 in PyEval_EvalFrameEx ()
#18 0x00000000004a8550 in PyEval_EvalFrameEx ()
#19 0x00000000004a9671 in PyEval_EvalCodeEx ()
#20 0x00000000004a9742 in PyEval_EvalCode ()
#21 0x00000000004c9a0e in PyRun_FileExFlags ()
#22 0x00000000004c9c24 in PyRun_SimpleFileExFlags ()
#23 0x000000000041a7ff in Py_Main ()
#24 0x00007ffff69d8c4d in __libc_start_main () from /lib/libc.so.6
#25 0x00000000004199f9 in _start ()
</pre></div>
</div>
</div>
<div class="section" id="exceptions">
<span id="index-1"></span><h2>Exceptions<a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h2>
<p>If your problem is e.g. a segfault or a null pointer dereference, just
running the script under gdb will get you to the point of the fault.
If on the other hand something is throwing an exception, the program
will exit:</p>
<div class="highlight-ectosh"><div class="highlight"><pre><span class="mf">(gdb)</span><span class="gd"> r</span>
Starting program: /usr/bin/python ../ecto/test/scripts/test_random.py
[Thread debugging using libthread_db enabled]
Traceback (most recent call last):
  File &quot;../ecto/test/scripts/test_random.py&quot;, line 22, in &lt;module&gt;
    test_random()
  File &quot;../ecto/test/scripts/test_random.py&quot;, line 16, in test_random
    sched.execute(niter=100)
RuntimeError: Original Exception: std::runtime_error
  What   : catastrophe!
  Module : Random
  Function: process
[Inferior 1 (process 11876) exited with code 01]
<span class="mf">(gdb)</span><span class="gd"> where</span>
No stack.
</pre></div>
</div>
<p>As you can see there is no helpful information here.  The trick is to
<tt class="docutils literal"><span class="pre">catch</span> <span class="pre">throw</span></tt>:</p>
<div class="highlight-ectosh"><div class="highlight"><pre><span class="mf">(gdb)</span><span class="gd"> catch throw</span>
Catchpoint 2 (throw)
<span class="mf">(gdb)</span><span class="gd"> r</span>
Starting program: /usr/bin/python ../ecto/test/scripts/test_random.py
[Thread debugging using libthread_db enabled]
Catchpoint 2 (exception thrown), 0x00007ffff4f0fde0 in __cxa_throw () from /usr/lib/libstdc++.so.6
<span class="mf">(gdb)</span><span class="gd"> where</span>
#0  0x00007ffff4f0fde0 in __cxa_throw () from /usr/lib/libstdc++.so.6
#1  0x00007fffeaa64707 in ecto_test::Uniform01::process (this=0x1033220, inputs=..., outputs=...)
    at /home/ecto_kitchen/ecto/test/modules/Uniform01.cpp:88
#2  0x00007fffeaa6b330 in ecto::cell_&lt;ecto_test::Uniform01&gt;::process (this=0x9737b0, inputs=..., outputs=...)
    at /home/ecto_kitchen/ecto/include/ecto/cell.hpp:366
#3  0x00007fffeaa6a27e in ecto::cell_&lt;ecto_test::Uniform01&gt;::dispatch_process (this=0x9737b0, inputs=..., outputs=...)
    at /home/ecto_kitchen/ecto/include/ecto/cell.hpp:378
<span class="mf">(gdb)</span><span class="gd"> up</span>
#1  0x00007fffeaa64707 in ecto_test::Uniform01::process (this=0x1033220, inputs=..., outputs=...)
    at /home/ecto_kitchen/ecto/test/modules/Uniform01.cpp:88
88          throw std::runtime_error(&quot;catastrophe!&quot;);
<span class="mf">(gdb)</span><span class="gd"> l</span>
83          ncalls=parameters.get&lt;unsigned&gt;(&quot;ncalls&quot;);
84        }
85
86        int process(const ecto::tendrils&amp; inputs, ecto::tendrils&amp; outputs)
87        {
88          throw std::runtime_error(&quot;catastrophe!&quot;);      // &lt;-    boom!
89
90          for (unsigned j=0; j&lt;ncalls; ++j)
91            *out_ = (*pimpl_)();
92          return ecto::OK;
</pre></div>
</div>
<p class="rubric">But python throws a zillion exceptions</p>
<p>That&#8217;s right, throws exceptions to indicate the end of a loop, and
this happens a lot during startup.  One option is to set a breakpoint
on the constructor of <tt class="docutils literal"><span class="pre">ecto::except::EctoException</span></tt> to differentiate
between innocuous throws and Bad Ones.  Here, we have a throw of an
EctoException (these are the ones that give you various information
about the source of the error:</p>
<div class="highlight-ectosh"><div class="highlight"><pre>ecto.NullTendril:            exception_type  NullTendril
                cell_name  mything::DrawLineSegments
                cell_type  mything::DrawLineSegments
            function_name  process

[Thread 0x7fffd3b72700 (LWP 24092) exited]
[Thread 0x7fffd1b08700 (LWP 24093) exited]
[Inferior 1 (process 24087) exited with code 01]
<span class="mf">(gdb)</span><span class="gd"> break ecto::except::EctoException::EctoException()</span>
Breakpoint 1 at 0x7ffff4eb1300: file /home/ecto_kitchen/src/ecto/src/lib/except.cpp, line 58. (2 locations)
<span class="mf">(gdb)</span><span class="gd"> r</span>
Starting program: /usr/bin/python ../src/mything/scripts/data_viewer.py
[New Thread 0x7fffd3b72700 (LWP 24097)]
[New Thread 0x7fffd1b08700 (LWP 24098)]

Breakpoint 1, ecto::except::EctoException::EctoException (this=0x7fffffffcf80, __vtt_parm=0x7ffff519eae0, __in_chrg=&lt;optimized out&gt;)
    at /home/ecto_kitchen/src/ecto/src/lib/except.cpp:58
58        EctoException::EctoException() {
<span class="mf">(gdb)</span><span class="gd"> where</span>
#0  ecto::except::EctoException::EctoException (this=0x7fffffffcf80, __vtt_parm=0x7ffff519eae0, __in_chrg=&lt;optimized out&gt;)
    at /home/ecto_kitchen/src/ecto/src/lib/except.cpp:58
#1  0x00007fffd3c88ea9 in ecto::except::NullTendril::NullTendril (this=&lt;optimized out&gt;, __in_chrg=&lt;optimized out&gt;, __vtt_parm=&lt;optimized out&gt;)
    at /home/ecto_kitchen/src/ecto/include/ecto/except.hpp:159
#2  0x00007fffd3c988d9 in get (this=0xed3af0) at /home/ecto_kitchen/src/ecto/include/ecto/spore.hpp:173
#3  operator* (this=0xed3af0) at /home/ecto_kitchen/src/ecto/include/ecto/spore.hpp:147
#4  mything::DrawLineSegments::process (this=0xed3ac0, in=&lt;optimized out&gt;, out=&lt;optimized out&gt;)
    at /home/ecto_kitchen/src/mything/src/texmex/DrawLineSegments.cpp:39
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="valgrind.html" title="Valgrind"
             >next</a> |</li>
        <li class="right" >
          <a href="ipython.html" title="Using IPython"
             >previous</a> |</li>
        <li><a href="../../../index.html">ecto</a> &raquo;</li>
          <li><a href="../index.html" >Usage</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011,  Willow Garage, Inc.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>