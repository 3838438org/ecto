

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Valgrind &mdash; ecto</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/breathe.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="ecto" href="../../../index.html" />
    <link rel="up" title="Usage" href="../index.html" />
    <link rel="next" title="Wrapping enumerations" href="../advanced/wrapping_enums.html" />
    <link rel="prev" title="Debugging with gdb" href="debugging.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../advanced/wrapping_enums.html" title="Wrapping enumerations"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="debugging.html" title="Debugging with gdb"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../index.html">ecto</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Usage</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/ecto210.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Valgrind</a><ul>
<li><a class="reference internal" href="#suppressions">Suppressions</a></li>
<li><a class="reference internal" href="#running-ecto-under-valgrind">Running ecto under valgrind</a></li>
<li><a class="reference internal" href="#profiling">Profiling</a></li>
<li><a class="reference internal" href="#debugging">Debugging</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="debugging.html"
                        title="previous chapter">Debugging with gdb</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../advanced/wrapping_enums.html"
                        title="next chapter">Wrapping enumerations</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../_sources/ecto/usage/external/valgrind.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <span class="target" id="index-0"></span><div class="section" id="valgrind">
<h1>Valgrind<a class="headerlink" href="#valgrind" title="Permalink to this headline">¶</a></h1>
<p>Valgrind is our tool of choice for hunting nasty memory errors and/or
profiling. Then again, if you just want to compare the performance of your cells using
<tt class="docutils literal"><span class="pre">callgrind</span></tt>, <tt class="docutils literal"><span class="pre">ecto</span></tt> provides runtime statistics as explained in <a class="reference internal" href="../tips/argparse.html#argparsing"><em>Command line helpers: getting stats, GUIS, a shell and more automagically !</em></a>.</p>
<div class="section" id="suppressions">
<h2>Suppressions<a class="headerlink" href="#suppressions" title="Permalink to this headline">¶</a></h2>
<p>First you&#8217;ll need to have a quick look at <a class="reference external" href="http://svn.python.org/projects/python/trunk/Misc/README.valgrind">what the Python devs say
about this</a>... in
short, for performance reasons python deliberately does some things
that look suspicious to valgrind but in fact are not.  So you&#8217;ll need
to use the suppressions file that comes with python, called
<a class="reference external" href="http://svn.python.org/projects/python/trunk/Misc/valgrind-python.supp">valgrind-python.supp</a>.
Download that via that link and <strong>READ THE FILE</strong>, there are some
suppressions you need to uncomment in there, if you don&#8217;t intend to
rebuild python itself.</p>
</div>
<div class="section" id="running-ecto-under-valgrind">
<h2>Running ecto under valgrind<a class="headerlink" href="#running-ecto-under-valgrind" title="Permalink to this headline">¶</a></h2>
<p>You must run valgrind on the python interpreter... not
the script!  That is, not:</p>
<div class="highlight-ectosh"><div class="highlight"><pre>valgrind --tool=memcheck --suppressions=valgrind-python.supp myscript.py
</pre></div>
</div>
<p>but:</p>
<div class="highlight-ectosh"><div class="highlight"><pre>valgrind --tool=memcheck --suppressions=valgrind-python.supp python myscript.py
</pre></div>
</div>
<p>This is basically the same situation/mechanism as when running ecto
scripts under <tt class="docutils literal"><span class="pre">gdb</span></tt>.</p>
</div>
<div class="section" id="profiling">
<h2>Profiling<a class="headerlink" href="#profiling" title="Permalink to this headline">¶</a></h2>
<p>To find the performance bottlenecks in your application you&#8217;ll
probably want to start with the graph that the threadpool scheduler
prints out at the end of each run, then narrow down your script to the
bits that take the longest time.  You can run under a Threadpool or
Singlethreaded scheduler, but valgrind will (on purpose) interfere
with your threads and ensure that things run essentially
singlethreaded, so the Singlethreaded scheduler probably makes more
sense: just less mechanics to go wrong.</p>
<p>I like to use some of callgrinds&#8217; nifty features to take a sample of a
plasm while it is running in a steady state, i.e. I start my plasm like this:</p>
<div class="highlight-ectosh"><div class="highlight"><pre><span class="mf">%</span><span class="gd"> valgrind --tool=callgrind --instr-atstart=no python ./colorize_clusters.py</span>
==5702== Callgrind, a call-graph generating cache profiler
==5702== Copyright (C) 2002-2010, and GNU GPL&#39;d, by Josef Weidendorfer et al.
==5702== Using Valgrind-3.6.1 and LibVEX; rerun with -h for copyright info
==5702== Command: python ../src/pcl/samples/ros/colorize_clusters.py
==5702==
==5702== For interactive control, run &#39;callgrind_control -h&#39;.
[ INFO] [1313713285.708789618]: Initialied ros. node_name: /colorize_clusters_1313713285457983466
[ INFO] [1313713288.407112127]: Subscribed to topic:/camera/depth_registered/points with queue size of 2
</pre></div>
</div>
<p>Where the &#8211;instr-atstart=no means that valgrind won&#8217;t actually do
anything.  When my app is running in a steady state, in another window execute:</p>
<div class="highlight-ectosh"><div class="highlight"><pre><span class="mf">%</span><span class="gd"> callgrind_control --instr=on</span>
PID 5702: python ./colorize_clusters.py [requesting &#39;+Instrumentation&#39;...]
OK.
</pre></div>
</div>
<p>Now you&#8217;ve started sampling.  Things will slow down... a <em>lot</em>.  After
I think callgrind has had time to collect some statistics (say twenty
runs through the graph), provoke a dump:</p>
<div class="highlight-ectosh"><div class="highlight"><pre><span class="mf">%</span><span class="gd"> callgrind_control --dump=tenframes_colorized</span>
PID 5702: python ./colorize_clusters.py [requesting &#39;Dump tenframes_colorized&#39;...]
OK.
</pre></div>
</div>
<p id="index-2">Now you can run that most awesome of tools <a class="reference external" href="http://kcachegrind.sourceforge.net/html/Home.html">kcachegrind</a> on the files that it outputs.</p>
</div>
<div class="section" id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h2>
<p>Same as above if you&#8217;re using valgrind&#8217;s tool <tt class="docutils literal"><span class="pre">memcheck</span></tt>: run
valgrind on the python interpreter, passing the script name as an
argument.  The</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../advanced/wrapping_enums.html" title="Wrapping enumerations"
             >next</a> |</li>
        <li class="right" >
          <a href="debugging.html" title="Debugging with gdb"
             >previous</a> |</li>
        <li><a href="../../../index.html">ecto</a> &raquo;</li>
          <li><a href="../index.html" >Usage</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011,  Willow Garage, Inc.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>