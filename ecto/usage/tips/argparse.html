

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Command line helpers: getting stats, GUIS, a shell and more automagically ! &mdash; ecto</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/breathe.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="ecto" href="../../../index.html" />
    <link rel="up" title="Usage" href="../index.html" />
    <link rel="next" title="Automatic Documentation and Ecto’s Sphinx Extensions" href="ectodoc.html" />
    <link rel="prev" title="Tendril Connections" href="connections.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ectodoc.html" title="Automatic Documentation and Ecto’s Sphinx Extensions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="connections.html" title="Tendril Connections"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../index.html">ecto</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Usage</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/ecto210.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Command line helpers: getting stats, GUIS, a shell and more automagically !</a><ul>
<li><a class="reference internal" href="#sample">sample</a></li>
<li><a class="reference internal" href="#ipython">ipython</a></li>
<li><a class="reference internal" href="#exposing-cells-to-the-parser">Exposing cells to the parser</a></li>
<li><a class="reference internal" href="#helper-functions">helper functions</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="connections.html"
                        title="previous chapter">Tendril Connections</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ectodoc.html"
                        title="next chapter">Automatic Documentation and Ecto&#8217;s Sphinx Extensions</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../_sources/ecto/usage/tips/argparse.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="command-line-helpers-getting-stats-guis-a-shell-and-more-automagically">
<span id="argparsing"></span><h1>Command line helpers: getting stats, GUIS, a shell and more automagically !<a class="headerlink" href="#command-line-helpers-getting-stats-guis-a-shell-and-more-automagically" title="Permalink to this headline">¶</a></h1>
<p>Requires the python <a class="reference external" href="http://docs.python.org/library/argparse.html">argparse</a> library.</p>
<p>Ecto has a few helper functions for commandline parsing using
the argparse library.  These are useful for having scripts that
may run with multiple ecto schedulers based on command line
args.</p>
<div class="section" id="sample">
<h2>sample<a class="headerlink" href="#sample" title="Permalink to this headline">¶</a></h2>
<p>A sample of using argparse with ecto.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># </span>
<span class="c"># Copyright (c) 2011, Willow Garage, Inc.</span>
<span class="c"># All rights reserved.</span>
<span class="c"># </span>
<span class="c"># Redistribution and use in source and binary forms, with or without</span>
<span class="c"># modification, are permitted provided that the following conditions are met:</span>
<span class="c">#     * Redistributions of source code must retain the above copyright</span>
<span class="c">#       notice, this list of conditions and the following disclaimer.</span>
<span class="c">#     * Redistributions in binary form must reproduce the above copyright</span>
<span class="c">#       notice, this list of conditions and the following disclaimer in the</span>
<span class="c">#       documentation and/or other materials provided with the distribution.</span>
<span class="c">#     * Neither the name of the Willow Garage, Inc. nor the names of its</span>
<span class="c">#       contributors may be used to endorse or promote products derived from</span>
<span class="c">#       this software without specific prior written permission.</span>
<span class="c"># </span>
<span class="c"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<span class="c"># AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span class="c"># IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<span class="c"># ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</span>
<span class="c"># LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
<span class="c"># CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<span class="c"># SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
<span class="c"># INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
<span class="c"># CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
<span class="c"># ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<span class="c"># POSSIBILITY OF SUCH DAMAGE.</span>
<span class="c"># </span>
<span class="kn">import</span> <span class="nn">ecto</span>
<span class="kn">from</span> <span class="nn">ecto.opts</span> <span class="kn">import</span> <span class="n">scheduler_options</span><span class="p">,</span> <span class="n">run_plasm</span>
<span class="kn">from</span> <span class="nn">ecto</span> <span class="kn">import</span> <span class="n">Constant</span>
<span class="kn">from</span> <span class="nn">ecto.ecto_test</span> <span class="kn">import</span> <span class="n">Multiply</span><span class="p">,</span> <span class="n">Printer</span>
<span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">&#39;My awesome program thing.&#39;</span><span class="p">)</span>

<span class="c">#our local command line args.</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--value&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;VALUE&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;value&#39;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;A value to use a constant.&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--factor&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;FACTOR&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;factor&#39;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;The factor to multiply the constant with.&#39;</span><span class="p">)</span>

<span class="c">#add ecto scheduler args.</span>
<span class="n">scheduler_options</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">factor</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">factor</span><span class="p">)</span>
<span class="n">pr</span> <span class="o">=</span> <span class="n">Printer</span><span class="p">()</span>
<span class="n">plasm</span> <span class="o">=</span> <span class="n">ecto</span><span class="o">.</span><span class="n">Plasm</span><span class="p">()</span>
<span class="n">plasm</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">c</span><span class="p">[:]</span> <span class="o">&gt;&gt;</span> <span class="n">m</span><span class="p">[:],</span>
              <span class="n">m</span><span class="p">[:]</span> <span class="o">&gt;&gt;</span> <span class="n">pr</span><span class="p">[:]</span>
              <span class="p">)</span>
<span class="c">#run the scheduler given the options, plasm, and our local variables.</span>
<span class="n">run_plasm</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">plasm</span><span class="p">,</span> <span class="nb">locals</span><span class="o">=</span><span class="nb">vars</span><span class="p">())</span>
</pre></div>
</div>
<p>Running with <tt class="docutils literal"><span class="pre">--help</span></tt> gives us:</p>
<div class="highlight-text"><div class="highlight"><pre>usage: sample_opts.py [-h] [--value VALUE] [--factor FACTOR]
                      [--niter ITERATIONS] [--shell] [--gui]
                      [--logfile LOGFILE] [--graphviz] [--dotfile DOTFILE]
                      [--stats]

My awesome program thing.

optional arguments:
  -h, --help          show this help message and exit
  --value VALUE       A value to use a constant.
  --factor FACTOR     The factor to multiply the constant with.

Ecto runtime parameters:
  --niter ITERATIONS  Run the graph for niter iterations. 0 means run until
                      stopped by a cell or external forces. (default: 0)
  --shell             &#39;Bring up an ipython prompt, and execute
                      asynchronously.(default: False)
  --gui               Bring up a gui to help execute the plasm.
  --logfile LOGFILE   Log to the given file, use tail -f LOGFILE to see the
                      live output. May be useful in combination with --shell
  --graphviz          Show the graphviz of the plasm. (default: False)
  --dotfile DOTFILE   Output a graph in dot format to the given file. If no
                      file is given, no output will be generated. (default: )
  --stats             Show the runtime statistics of the plasm.
</pre></div>
</div>
</div>
<div class="section" id="ipython">
<h2>ipython<a class="headerlink" href="#ipython" title="Permalink to this headline">¶</a></h2>
<p>To use with ipython, simply pass <tt class="docutils literal"><span class="pre">--shell</span></tt> to the sample.  This will result
in the plasm being executed asynchronously, and pop you out into an
ipython shell.</p>
<div class="highlight-ectosh"><div class="highlight"><pre><span class="mf">%</span><span class="gd">  ./sample_opts.py --shell --niter=3</span>
***** 15 ***** 0x14e1a90
***** 15 ***** 0x14e1a90
***** 15 ***** 0x14e1a90


Input &lt;1&gt;c.outputs.out
 Out[1]: 3

Input &lt;2&gt;m.outputs.out
 Out[2]: 15.0

Input &lt;3&gt;c.outputs.out = 5

Input &lt;4&gt;sched.execute(niter=2)
***** 25 ***** 0x14e1a90
***** 25 ***** 0x14e1a90
 Out[4]: 0
</pre></div>
</div>
<p>Notice how the shell has access to the local variables declared
in the script.</p>
</div>
<div class="section" id="exposing-cells-to-the-parser">
<h2>Exposing cells to the parser<a class="headerlink" href="#exposing-cells-to-the-parser" title="Permalink to this headline">¶</a></h2>
<p>You can also automatically expose any of the parameters in a Cell like object
to the argparse parser.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="kn">from</span> <span class="nn">ecto</span> <span class="kn">import</span> <span class="n">Constant</span>
<span class="kn">from</span> <span class="nn">ecto.ecto_test</span> <span class="kn">import</span> <span class="n">Multiply</span>
<span class="kn">import</span> <span class="nn">argparse</span>

<span class="kn">from</span> <span class="nn">ecto.opts</span> <span class="kn">import</span> <span class="n">cell_options</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">&#39;My awesome program thing.&#39;</span><span class="p">)</span>

<span class="c">#add our cells to the parser</span>
<span class="n">multiply_factory</span> <span class="o">=</span> <span class="n">cell_options</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">Multiply</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;mult&#39;</span><span class="p">)</span>
<span class="n">const_factory</span> <span class="o">=</span> <span class="n">cell_options</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">Constant</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.50505</span><span class="p">),</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;const&#39;</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="c">#use the factories in conjunction with the parsed arguments, to create our cells.</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">const_factory</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">multiply_factory</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

<span class="c"># ... construct graph do whatever else...</span>
</pre></div>
</div>
<p>The help looks like:</p>
<div class="highlight-text"><div class="highlight"><pre>usage: sample_opts2.py [-h] [--mult_factor MULT_FACTOR]
                       [--const_value CONST_VALUE]

My awesome program thing.

optional arguments:
  -h, --help            show this help message and exit

mult options:
  --mult_factor MULT_FACTOR
                        A factor to multiply by. ~ (default: 3.14)

const options:
  --const_value CONST_VALUE
                        Value to output ~ (default: 0.50505)
</pre></div>
</div>
<dl class="function">
<dt id="ecto.opts.cell_options">
<tt class="descclassname">ecto.opts.</tt><tt class="descname">cell_options</tt><big>(</big><em>parser</em>, <em>CellType</em>, <em>prefix=None</em><big>)</big><a class="reference internal" href="../../../_modules/ecto/opts.html#cell_options"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ecto.opts.cell_options" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates an argument parser group for any cell.
CellType may be either a __class__ type, or an instance object.</p>
<p>cell_options returns a cell factory. The cell factory can be used to produce
an instance of a cell based on the arguments parsed.</p>
</dd></dl>

</div>
<div class="section" id="helper-functions">
<h2>helper functions<a class="headerlink" href="#helper-functions" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ecto.opts.use_ipython">
<tt class="descclassname">ecto.opts.</tt><tt class="descname">use_ipython</tt><big>(</big><em>options</em>, <em>sched</em>, <em>plasm</em>, <em>locals={}</em><big>)</big><a class="reference internal" href="../../../_modules/ecto/opts.html#use_ipython"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ecto.opts.use_ipython" title="Permalink to this definition">¶</a></dt>
<dd><p>Launch a plasm using ipython, and a scheduler of choice.</p>
<p>Keyword arguments:
options &#8211; are from scheduler_options
sched &#8211; is an already initialized scheduler for plasm.
plasm &#8211; The graph to execute
locals &#8211; are a dictionary of locals to forward to the ipython shell, use locals()</p>
<p>The variables options, sched, plasm, and all locals passed in will
be available in the ipython context.</p>
</dd></dl>

<dl class="function">
<dt id="ecto.opts.run_plasm">
<tt class="descclassname">ecto.opts.</tt><tt class="descname">run_plasm</tt><big>(</big><em>options</em>, <em>plasm</em>, <em>locals={}</em><big>)</big><a class="reference internal" href="../../../_modules/ecto/opts.html#run_plasm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ecto.opts.run_plasm" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the plasm given the options from the command line parser.
:param options: The command line, preparsed options object.
It is assumed that you have filled this object using scheduler_options.
:param plasm: The plasm to run.
:param locals: Any local variables that you would like available to the iPython shell session.</p>
</dd></dl>

<dl class="function">
<dt id="ecto.opts.scheduler_options">
<tt class="descclassname">ecto.opts.</tt><tt class="descname">scheduler_options</tt><big>(</big><em>parser</em>, <em>default_niter=0</em>, <em>default_shell=False</em>, <em>default_graphviz=False</em><big>)</big><a class="reference internal" href="../../../_modules/ecto/opts.html#scheduler_options"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ecto.opts.scheduler_options" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates an argument parser for ecto schedulers.  Operates inplace on the
given parser object.</p>
</dd></dl>

<dl class="function">
<dt id="ecto.opts.doit">
<tt class="descclassname">ecto.opts.</tt><tt class="descname">doit</tt><big>(</big><em>plasm</em>, <em>description='An ecto graph.'</em>, <em>locals={}</em>, <em>args=None</em>, <em>default_niter=0</em>, <em>default_shell=False</em>, <em>default_graphviz=False</em><big>)</big><a class="reference internal" href="../../../_modules/ecto/opts.html#doit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ecto.opts.doit" title="Permalink to this definition">¶</a></dt>
<dd><p>doit is a short hand for samples, that is a combination of a
call to scheduler_options, and then run_plasm.  This function
in not intended to allow customization of parameter parsing.
If this is needed please call scheduler_options and run_plasm
yourself.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>args</strong> &#8211; If this is None, default to using the sys.argv
args, otherwise this overrides it.</li>
<li><strong>locals</strong> &#8211; May be used to forward any local variables to
the ipython shell. Suggest either vars() or locals() to do
this.</li>
<li><strong>default_shell</strong> &#8211; Override</li>
<li><strong>default_graphviz</strong> &#8211; Override</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ectodoc.html" title="Automatic Documentation and Ecto’s Sphinx Extensions"
             >next</a> |</li>
        <li class="right" >
          <a href="connections.html" title="Tendril Connections"
             >previous</a> |</li>
        <li><a href="../../../index.html">ecto</a> &raquo;</li>
          <li><a href="../index.html" >Usage</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011,  Willow Garage, Inc.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>